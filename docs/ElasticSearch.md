# 认识ElasticSearch

## 1. 基本概念

- 索引（Index）

````
    ElasticSearch把数据存放到一个或者多个索引(indices)中。如果用关系型数据库模型对比，索引(index)的地位与数据库实例(database)相当。索引存放和读取的基本单元是文档(Document)。我们也一再强调，ElasticSearch内部用Apache Lucene实现索引中数据的读写。读者应该清楚的是：在ElasticSearch中被视为单独的一个索引(index)，在Lucene中可能不止一个。这是因为在分布式体系中，ElasticSearch会用到分片(shards)和备份(replicas)机制将一个索引(index)存储多份。
````

- 文档（Document）

````
    在ElasticSearch的世界中，文档是主要的存在实体。所有的ElasticSearch应用需求到最后都可以统一建模成一个检索模型：检索相关文档。文档由一个或者多个域(Field)组成，每个域(Field)由一个域名(此域名非彼域名)和一个或者多个值组成(有多个值的值称为多值域(multi-valued))。在ElasticSearch中，每个文档都可能会有不同的域(Field)集合；也就是说文档(Document)是没有固定的模式和统一的结构。文档(Document)之间保持结构的相似性即可。从客户端的角度来看，文档就是一个JSON对象。
````

- 参数映射(Mapping)

````
    所有的文档(Document)在存储之前都必须经过分析(analyze)流程。用户可以配置输入文本分解成Token的方式；哪些Token应该被过滤掉；或者其它的的处理流程，比如去除HTML标签。此外，ElasticSearch提供的各种特性，比如排序的相关信息。保存上述的配置信息，这就是参数映射(Mapping)在ElasticSearch中扮演的角色。尽管ElasticSearch可以根据域的值自动识别域的类型(field type)，在生产应用中，都是需要自己配置这些信息以避免一些奇的问题发生。要保证应用的可控性。
````

- 文档类型（Type）

````
    每个文档在ElasticSearch中都必须设定它的类型。文档类型使得同一个索引中在存储结构不同文档时，只需要依据文档类型就可以找到对应的参数映射(Mapping)信息，方便文档的存取。
````

- 节点（Node）

````
    单独一个ElasticSearch服务器实例称为一个节点。对于许多应用场景来说，部署一个单节点的ElasticSearch服务器就足够了。但是考虑到容错性和数据过载，配置多节点的ElasticSearch集群是明智的选择。
````

- 集群（Cluster）

````
    集群是多个ElasticSearch节点的集合。这些节点齐心协力应对单个节点无法处理的搜索需求和数据存储需求。集群同时也是应对由于部分机器(节点)运行中断或者升级导致无法提供服务这一问题的利器。ElasticSearch提供的集群各个节点几乎是无缝连接(即集群对外而言是一个整体，增加一个节点或者去掉一个节点对用户而言是透明的)。
````

- 分片索引（Shard）

````
    集群能够存储超出单机容量的信息。为了实现这样的需求，ES把数据分发到多个存储Lucene索引的物理机上。这些索引被称为分片索引，简称分片。在ES集群中，分片是自动完成的，并且所有分片是作为一个整体呈现给用户的。需要注意的是：尽管索引分片的过程是自动的，但是在应用中需要事先调整好参数。因为集群中分片的数量需要在索引创建前配置好，并且服务器启动后是无法修改的，至少目前无法修改。
````

- 索引副本（Replica）

````
    通过索引分片机制（Sharding）可以向ElasticSearch集群中导入超过单机容量的数据，客户端操作任意一个节点即可实现对集群数据的读写操作。当集群负载增长，用户搜索请求阻塞在单个节点上时，通过索引副本机制就可以解决这个问题。索引副本机制的思路很简单：为索引分片创建一份新的考本，它可以像原来的主分片一样处理用户搜索请求，同时也顺便保证了数据的安全性。即使主分片数据丢失，ElasticSearch也通过索引副本是的数据不丢失。与分片索引不同的是，索引副本可以随时添加或者删除，所以用户可以在需要的时候动态调整其数量。
````

- 时间之门（Gateway）

````

````

## ElasticSearch的工作原理

- 启动过程
````
    
````